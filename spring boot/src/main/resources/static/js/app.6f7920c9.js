(function(t){function e(e){for(var i,a,r=e[0],l=e[1],c=e[2],m=0,g=[];m<r.length;m++)a=r[m],n[a]&&g.push(n[a][0]),n[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);u&&u(e);while(g.length)g.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var t,e=0;e<o.length;e++){for(var s=o[e],i=!0,r=1;r<s.length;r++){var l=s[r];0!==n[l]&&(i=!1)}i&&(o.splice(e--,1),t=a(a.s=s[0]))}return t}var i={},n={app:0},o=[];function a(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=i,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(s,i,function(e){return t[e]}.bind(null,i));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;o.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},5622:function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);s("cadf"),s("551c"),s("f751"),s("097d");var i=s("2b0e"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},o=[],a={},r=a,l=(s("5c0b"),s("2877")),c=Object(l["a"])(r,n,o,!1,null,null,null),u=c.exports,m=s("8c4f"),g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{"font-size":"24px","text-align":"center"},attrs:{id:"login"}},[t.islogin?s("div",{staticClass:"login_box"},[s("h3",[t._v("Web Talk")]),s("div",{staticClass:"login_input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.login.name,expression:"login.name"}],attrs:{placeholder:"用户名"},domProps:{value:t.login.name},on:{input:function(e){e.target.composing||t.$set(t.login,"name",e.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.login.password,expression:"login.password"}],attrs:{placeholder:"密码",type:"password"},domProps:{value:t.login.password},on:{input:function(e){e.target.composing||t.$set(t.login,"password",e.target.value)}}})]),s("a",{staticClass:"login_tip",attrs:{href:"#"}},[t._v("忘记密码了？")]),s("div",{staticClass:"login_button"},[s("button",{on:{click:function(e){t.islogin=!1}}},[t._v("注册")]),s("button",{on:{click:t.loginsubmit}},[t._v("登录")])])]):s("div",{staticClass:"login_box"},[s("h4",[t._v("来加入我们吧")]),s("div",{staticClass:"login_input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.register.name,expression:"register.name"}],attrs:{placeholder:"用户名"},domProps:{value:t.register.name},on:{input:function(e){e.target.composing||t.$set(t.register,"name",e.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.register.email,expression:"register.email"}],attrs:{placeholder:"邮箱",type:"email"},domProps:{value:t.register.email},on:{input:function(e){e.target.composing||t.$set(t.register,"email",e.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.register.password,expression:"register.password"}],attrs:{placeholder:"密码",type:"password"},domProps:{value:t.register.password},on:{input:function(e){e.target.composing||t.$set(t.register,"password",e.target.value)}}})]),s("div",{staticClass:"login_button"},[s("button",{on:{click:function(e){t.islogin=!0}}},[t._v("返回")]),s("button",{on:{click:t.registerSubmit}},[t._v("注册")])])])])},d=[],p=(s("7f7f"),s("bc3a")),f=s.n(p),h=s("4328"),v=s.n(h),b={data:function(){return{title:"我是頭部",islogin:!0,login:{name:"",password:""},register:{email:"",name:"",password:""}}},mounted:function(){Notification.requestPermission()},methods:{loginsubmit:function(){var t=this,e=this.login,s=e.name,i=e.password;""!=s&&""!=i&&f.a.post("/user/login",v.a.stringify({name:s,password:i})).then(function(e){1==e.data.length&&(localStorage.setItem("login",JSON.stringify(e.data[0])),t.$store.commit("userlogin",e.data[0]),t.$router.push({path:"/"}))})},registerSubmit:function(){var t=this,e=this.productUid(),s=this.register,i=s.name,n=s.password,o=s.email;i.length>=3&&n.length>=6?f.a.get("/user/register?name=".concat(i,"&email=").concat(o,"&password=").concat(n,"&uid=").concat(e)).then(function(e){t.islogin=!0,t.$message({message:"注册成功，请进行登录吧！",type:"success"})}).catch(function(e){t.$message.error("账号名重复")}):this.$message.error("账号名不得少于三位且密码不得少于六位数")},productUid:function(){for(var t="",e=0;e<6;e++)t+=Math.floor(10*Math.random());return t}}},y=b,_=(s("f293"),Object(l["a"])(y,g,d,!1,null,"6664dc74",null)),k=_.exports,C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{style:{background:t.bg},attrs:{id:"socket"}},[t.em?s("VEmojiPicker",{staticClass:"emojibox",attrs:{pack:t.pack},on:{select:t.selectEmoji}}):t._e(),s("div",{staticClass:"tools"},[s("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"}},[s("div",{staticClass:"bgTheme"},[s("div",{staticClass:"themeColor"},[s("div",{staticClass:"colorExp"},[s("span",{style:{background:"#B0E2FF"},on:{click:function(e){t.bgtemp="#B0E2FF"}}},[t._v("#B0E2FF")]),s("span",{style:{background:"#FFC1C1"},on:{click:function(e){t.bgtemp="#FFC1C1"}}},[t._v("#FFC1C1")])]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.bgtemp,expression:"bgtemp"}],attrs:{type:"text"},domProps:{value:t.bgtemp},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.colorChange(e)},input:function(e){e.target.composing||(t.bgtemp=e.target.value)}}})]),s("div",{staticClass:"themeButton"},[s("el-button",{on:{click:t.resetColor}},[t._v("恢复默认")]),s("el-button",{on:{click:t.colorChange}},[t._v("确定")])],1)]),s("div",{staticClass:"clearStorage",attrs:{slot:"reference"},slot:"reference"},[s("i",{staticClass:"el-icon-brush"})])]),s("div",{staticClass:"clearStorage",on:{click:t.removeStorage}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除聊天记录",placement:"bottom"}},[s("i",{staticClass:"el-icon-delete"})])],1),s("div",{staticClass:"clearStorage",on:{click:t.loginout}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"退出登录",placement:"bottom"}},[s("i",{staticClass:"el-icon-switch-button"})])],1)],1),s("div",{ref:"listbox",staticClass:"socket_list",style:{top:t.list_xy.y+"px",left:t.list_xy.x+"px"},on:{mousedown:t.listStart,mouseup:t.listEnd}},[s("div",{staticClass:"list_top"},[s("div",{staticClass:"user_box"},[s("div",{staticClass:"name_img"},[t.avaterif?s("avatar",{attrs:{username:t.msid.name,size:35}}):t._e(),s("h5",[t._v(t._s(t.msid.name))])],1),s("span",{staticStyle:{cursor:"pointer"},on:{click:[t.getOnlineUser,function(t){t.stopPropagation()}]}},[s("i",{staticClass:"el-icon-refresh"})])]),s("div",{staticClass:"search_box"},[s("i",{staticClass:"el-icon-search"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],attrs:{placeholder:"请输入内容"},domProps:{value:t.search},on:{input:function(e){e.target.composing||(t.search=e.target.value)}}})])]),s("div",{staticClass:"list_bodys"},[s("ul",[s("li",{staticClass:"list_li",on:{click:t.publicButton}},[s("div",{staticClass:"list_name_img"},[s("avatar",{attrs:{username:"Public Chat",size:35}}),t._m(0)],1)]),t._l(t.userinfo,function(e,i){return s("li",{key:i,staticClass:"list_li",on:{click:function(s){return t.clickButton(e.uid,e.name)}}},[s("div",{staticClass:"list_name_img"},[s("avatar",{attrs:{username:e.name,size:35}}),s("div",{staticClass:"name_msg"},[s("h5",[t._v(t._s(e.name))])])],1)])})],2)])]),t.winshow?s("div",{ref:"talkbox",staticClass:"socket_talk",style:{top:t.talk_xy.y+"px",left:t.talk_xy.x+"px"}},[s("div",{staticClass:"talk_top",on:{mousedown:t.talkStart,mouseup:t.talkEnd}},[s("h4",[t._v(t._s(this.winname))]),s("span",{on:{click:[t.close,function(t){t.stopPropagation()}]}},[s("i",{staticClass:"el-icon-close"})])]),s("div",{ref:"talkbody",staticClass:"talk_body",on:{click:function(e){t.em=!1}}},[s("ul",t._l(t.messageList,function(e,i){return s("li",{key:i,staticClass:"talk_msg",style:{flexDirection:1==e.id?"row":"row-reverse"}},[1==e.id?s("avatar",{attrs:{username:e.name,size:35}}):s("avatar",{attrs:{username:t.msid.name,size:35}}),s("div",{style:{flexDirection:0==e.id?"row":"row-reverse"}},[1==e.id?s("span",[t._v(t._s(e.name))]):s("span",[t._v(t._s(t.msid.name))]),s("p",{staticClass:"talk_content"},[t._v(t._s(e.msg))])])],1)}),0)]),s("div",{staticClass:"talk_send"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.msginput,expression:"msginput"}],staticClass:"talk_input",attrs:{type:"text"},domProps:{value:t.msginput},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage(e)},input:function(e){e.target.composing||(t.msginput=e.target.value)}}}),s("span",{staticClass:"talk_truck_icon",on:{click:function(e){t.em=!t.em}}},[s("i",{staticClass:"el-icon-truck"})]),s("span",{staticClass:"talk_send_icon",on:{click:t.sendMessage}},[s("i",{staticClass:"el-icon-s-promotion"})])])]):t._e()],1)},x=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"name_msg"},[s("h5",[t._v("Public Chat")])])}],w=s("4a89"),S=s.n(w),O=s("cc7d"),$=s.n(O),N=s("74d1"),j=s.n(N),E=(s("4be7"),s("4548")),P=s.n(E),L=s("59e2"),M=s("5118"),J={components:{VEmojiPicker:P.a,Avatar:S.a},data:function(){return{pack:L,em:!1,mouselist:!1,winshow:!0,search:"",stompClient:"",timer:"",winname:"Public Chat",imageUrl:"",talk_xy:{x:450,y:50},list_xy:{x:50,y:50},movexy:{x:0,y:0},dialogFormVisible:!1,form:{name:"",email:""},formLabelWidth:"80px",bg:"",bgtemp:"",avaterif:!1,usid:[],public:[],msid:"",osid:"",msginput:"",messageList:[],messagestore:[],userinfo:[]}},mounted:function(){localStorage.getItem("bgbase")?this.bg=localStorage.getItem("bgbase"):this.resetColor(),localStorage.getItem("messagestore")&&(this.messagestore=JSON.parse(localStorage.getItem("messagestore"))),localStorage.getItem("login")&&this.$store.commit("userlogin",JSON.parse(localStorage.getItem("login"))),localStorage.getItem("login")&&(this.msid=JSON.parse(localStorage.getItem("login")),this.initWebSocket(),this.publicButton())},beforeDestroy:function(){0==this.$store.state.current&&(this.disconnect(),clearInterval(this.timer))},methods:{selectEmoji:function(t){this.msginput=this.msginput+t.emoji},initWebSocket:function(){this.connection();this.timer=setInterval(function(){},5e3)},connection:function(){var t=this,e=new $.a("/queueServer");this.stompClient=j.a.over(e);this.stompClient.connect({},function(){t.stompClient.send("/app/online",{},JSON.stringify({uid:t.msid.uid})),t.stompClient.subscribe("/user/"+t.msid.uid+"/message",function(e){var s=e.body,i=JSON.parse(s);t.newMessage(i.form);var n=t.messagestore;n.push(JSON.parse(s)),localStorage.setItem("messagestore",JSON.stringify(n)),t.messagestore=n,t.osid==JSON.parse(s).form&&t.clickButton(t.osid,t.winname)}),t.stompClient.subscribe("/user/public/message",function(e){var s=e.body;JSON.parse(s);t.public.push(JSON.parse(s)),"public"==t.osid&&t.publicButton()}),t.stompClient.subscribe("/user/online/message",function(e){Object(M["setTimeout"])(function(){t.getOnlineUser()},200)}),t.stompClient.subscribe("/user/offline/message",function(e){Object(M["setTimeout"])(function(){t.getOnlineUser()},200)}),f.a.get("/line/online?name=".concat(t.msid.name,"&avater=1&uid=").concat(t.msid.uid)).then(function(e){t.getOnlineUser(),console.log("在线")})},function(t){console.log("失败"),console.log(t)})},disconnect:function(){this.stompClient&&(this.stompClient.send("/app/offline",{},JSON.stringify({uid:this.msid.uid})),this.stompClient.disconnect())},getOnlineUser:function(){var t=this;f.a.get("/line/list").then(function(e){t.avaterif=!0,t.userinfo=[],e.data.map(function(e){return t.msid.uid!=e.uid&&t.userinfo.push(e),e})})},newMessage:function(t){var e=this,s=this.userinfo;s.map(function(s){if(s.uid==t){e.$message("你有一条来自"+s.name+"新消息");new Notification("收到新信息",{body:"你有一条来自"+s.name+"新消息"})}})},uidgetName:function(t){var e=this.userinfo,s="";return e.map(function(e){return e.uid==t&&(s=e.name),e}),s},publicButton:function(){var t=this,e="public";this.winshow=!0,this.osid=e,this.winname="Public Chat",this.messageList=[],this.public.map(function(s){return s.form==t.msid.uid&&s.to==e?t.messageList.push({id:0,msg:s.message,name:t.msid.name}):s.to==e&&t.messageList.push({id:1,msg:s.message,name:t.uidgetName(s.form)}),s});var s=this.$refs.talkbody;Object(M["setTimeout"])(function(){s.scrollHeight&&(s.scrollTop=s.scrollHeight+60)},50)},clickButton:function(t,e){var s=this;this.winshow=!0,this.osid=t,this.winname=e,this.messageList=[],this.messagestore.map(function(e){return e.form==t&&e.to==s.msid.uid?s.messageList.push({id:1,msg:e.message,name:s.uidgetName(e.form)}):e.form==s.msid.uid&&e.to==t&&s.messageList.push({id:0,msg:e.message,name:s.msid.name}),e});var i=this.$refs.talkbody;Object(M["setTimeout"])(function(){i.scrollHeight&&(i.scrollTop=i.scrollHeight+60)},50)},sendMessage:function(){this.stompClient.send("/app/queue",{},JSON.stringify({username:this.msid.uid,sendname:this.osid,content:this.msginput}));var t={form:this.msid.uid,message:this.msginput,to:this.osid};this.messagestore.push(t),localStorage.setItem("messagestore",JSON.stringify(this.messagestore)),this.msginput="","public"==this.osid?this.publicButton():this.clickButton(this.osid,this.winname)},handleAvatarSuccess:function(t,e){this.imageUrl=URL.createObjectURL(e.raw)},beforeAvatarUpload:function(t){var e="image/jpeg"===t.type,s=t.size/1024/1024<2;return e||this.$message.error("上传头像图片只能是 JPG 格式!"),s||this.$message.error("上传头像图片大小不能超过 2MB!"),this.getBase64(t,function(t){}),!1},getBase64:function(t,e){var s=new FileReader;s.addEventListener("load",function(){return e(s.result)}),s.readAsDataURL(t)},close:function(){this.me=!1,this.winshow=!1},resetColor:function(){this.bg="url('/default.jpg') no-repeat center",this.bgtemp=""},colorChange:function(){var t=this.bgtemp;""!=t&&(7==t.length&&"#"==t[0]?(this.bg=t,this.bgtemp=""):0==t.indexOf("http")&&(this.bg="url('".concat(this.bgtemp,"') no-repeat center"),this.bgtemp="")),localStorage.setItem("bgbase",this.bg)},removeStorage:function(){localStorage.removeItem("messagestore"),this.$message({message:"刷新后删除所有聊天记录",type:"success"})},message:function(){var t=this.$createElement;this.$notify({title:"标题名称",message:t("i",{style:"color: teal"},"这是提示文案这是提示文案这是提示文案这是提示文案这是提示文案这是提示文案这是提示文案这是提示文案")})},listStart:function(t){var e=this.list_xy,s=e.x,i=e.y,n={x:t.screenX-s,y:t.screenY-i};this.movexy=n,this.mouselist=!0,this.$refs.listbox.addEventListener("mousemove",this.listMove,!1)},listMove:function(t){this.mouselist&&(this.list_xy={x:t.screenX-this.movexy.x,y:t.screenY-this.movexy.y})},listEnd:function(){this.mouselist=!1,this.$refs.listbox.removeEventListener("mousemove",this.listMove,!1)},talkStart:function(t){var e=this.talk_xy,s=e.x,i=e.y,n={x:t.screenX-s,y:t.screenY-i};this.movexy=n,this.mouselist=!0,this.$refs.talkbox.addEventListener("mousemove",this.talkMove,!1)},talkMove:function(t){this.mouselist&&(this.talk_xy={x:t.screenX-this.movexy.x,y:t.screenY-this.movexy.y})},talkEnd:function(){this.mouselist=!1,this.$refs.talkbox.removeEventListener("mousemove",this.talkMove,!1)},loginout:function(){var t=this;this.$store.commit("userloginout"),localStorage.removeItem("login"),this.disconnect(),f.a.get("/line/offline?uid=".concat(this.msid.uid)).then(function(e){console.log("退出登录成功"),t.$router.push({path:"/login"})})}}},B=J,I=(s("f34e"),Object(l["a"])(B,C,x,!1,null,"59e94a4f",null)),F=I.exports;i["default"].use(m["a"]);var U=new m["a"]({mode:"history",base:"/",routes:[{path:"/",name:"home",component:F},{path:"/login",name:"Login",component:k}]}),T=s("2f62");i["default"].use(T["a"]);var z=new T["a"].Store({state:{user:{},current:0},mutations:{userlogin:function(t,e){t.user=e,t.current=1},userloginout:function(t){t.user={},t.current=0}},actions:{}}),A=s("5c96"),D=s.n(A);s("0fae");i["default"].config.productionTip=!1,i["default"].use(D.a),new i["default"]({router:U,store:z,render:function(t){return t(u)}}).$mount("#app")},"5c0b":function(t,e,s){"use strict";var i=s("5e27"),n=s.n(i);n.a},"5e27":function(t,e,s){},"865b":function(t,e,s){},f293:function(t,e,s){"use strict";var i=s("865b"),n=s.n(i);n.a},f34e:function(t,e,s){"use strict";var i=s("5622"),n=s.n(i);n.a}});
//# sourceMappingURL=app.6f7920c9.js.map